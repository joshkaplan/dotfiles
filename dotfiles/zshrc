# ZSH Config
# Josh Kaplan

export ZSH=$HOME/.oh-my-zsh
export SSH_KEY_PATH="~/.ssh/dsa_id" # SSH

# PATH
BREW_BIN="/opt/homebrew/bin"
export PATH="$BREW_BIN:$PATH"
export PATH="$PATH:/Users/jkaplan/.local/bin" # pipx

# Editors
export EDITOR=vim
export VISUAL=vim

ZSH_THEME="powerlevel10k"
DEFAULT_USER="josh"
ENABLE_CORRECTION="true" # Auto Correct

# Brew Shell Completions
# @note: must be initialized before oh-my-zsh
# @see: https://docs.brew.sh/Shell-Completion
if type brew &>/dev/null; then
  FPATH=$BREW_BIN/share/zsh/site-functions:$FPATH

  autoload -Uz compinit
  compinit
fi

# LIBRARIES 
##############################

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# oh-my-zsh
plugins=(git sublime macos asdf)
source $ZSH/oh-my-zsh.sh

# p10k configuration (originally; generated by `p10k configure`)
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

# Shell integration
test -e "${HOME}/.iterm2_shell_integration.zsh" && source "${HOME}/.iterm2_shell_integration.zsh"

# rbenv (ruby)
eval "$(rbenv init -)"

# Github
eval "$(hub alias -s)"

# nvm
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion

# virtualenv
export WORKON_HOME=~/localdev/venvs
export VIRTUALENVWRAPPER_PYTHON="$BREW_BIN/python3"
VIRTUAL_ENV_DISABLE_PROMPT="true"
[ -f "$BREW_BIN/virtualenvwrapper.sh" ] && source "$BREW_BIN/virtualenvwrapper.sh"

# pyenv (python)
eval "$(pyenv init -)"

# SETTINGS
##############################

# Vim Keybindings
bindkey -v

# Separate Histories (must be unset after loading oh-my-zsh)
# iTerm keeps a combined history anyway, and this enables up/down arrow to be session-specific
# TODO it might be nice to improve new session / restore session behavior
unsetopt inc_append_history
unsetopt share_history

# Online Help
# unalias run-help
autoload run-help
HELPDIR=/usr/local/share/zsh/help

# Auto Completion
zmodload zsh/complist
bindkey -M menuselect ' ' accept-and-infer-next-history
bindkey -M menuselect '^?' undo

# SOURCE MORE STUFF
##############################

# Aliases (sourced near the end so they override other defaults)
source ~/.dotfiles/dotfiles/aliases.zsh

# Local overrides
if [ -e ~/.local.zsh ]; then
    source ~/.local.zsh
fi
